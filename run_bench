#!/bin/bash
# Basic script that calls pt2pt/osu_latency
#SBATCH --time=0:05:00
#SBATCH --nodes=2
#SBATCH --tasks-per-node=1
#SBATCH --exclusive
#SBATCH -o /gpfs/data/ccvstaff/osu-benchmarks/%j.out

# Environment
module load mpi osu-mpi/5.6.2_mvapich2-2.3a_gcc

# Output Job ID
echo -n "job_id,"
echo $SLURM_JOB_ID

# Output CPU Family Name and Node Numbers
srun --mpi=pmi2 sh -c "(echo $SLURM_PROCID && hostname -s && cat /sys/devices/cpu/caps/pmu_name) | sed -z 's/\s/,/g' | sed 's/.$/\n/'" 

# Perform pt2pt latency test
srun --mpi=pmi2 osu_latency

